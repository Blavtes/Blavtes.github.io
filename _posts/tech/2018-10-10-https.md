---
layout: post
title: æœ¬åœ°å¼€å¯httpsæœåŠ¡
category: æŠ€æœ¯
tags: https
description: æœ¬åœ°å¼€å¯httpsæœåŠ¡
--- 

###

##è‡ªç­¾åè¯ä¹¦

##é…ç½®ApacheæœåŠ¡å™¨SSL

##è‡ªå·±ä½œä¸ºCAç­¾å‘è¯ä¹¦

###è¿™é‡Œæ˜¯OpenSSLå’ŒHTTPSçš„ä»‹ç»

[OpenSSL](http://baike.baidu.com/link?url=G3F0TfAdE17g1YVM_4gh-2fo3fov7oLnrkqF24BiMmy2kFsK0P1oJ67OwSlu96XH7kJi_ZCSUxBl9cUES7JV0K)

[HTTPS](http://baike.baidu.com/link?url=LEU1yRshjNFoZhRS0F4CJFn-QpiCvJP4zDkD3egiwPN1JG7vw-p95Uk__ZKue-n34OrQdkGL_aHRyh2oGih8ya)

å¼€å¯`HTTPS`é…ç½®å‰ææ˜¯å·²åœ¨`Macä¸Š`æ­å»º`Apache`æœåŠ¡å™¨
â†’`Macä¸ŠApache`æœåŠ¡å™¨æ­å»º

å…ˆåœ¨æ¡Œé¢åˆ›å»ºä¸ª`SSLæ–‡`ä»¶å¤¹ï¼Œç”¨æ¥æ”¾ç”Ÿæˆçš„ç§é’¥è¯ä¹¦æ–‡ä»¶
æ‰“å¼€ç»ˆç«¯`cd`åˆ°`SSL`æ–‡ä»¶å¤¹

	cd desktop/SSL

#1. è‡ªç­¾åè¯ä¹¦

(1) åœ¨SSLæ–‡ä»¶å¤¹ä¸­ç”Ÿæˆç§é’¥

	openssl genrsa -out server.key 2048
	
ç”Ÿæˆ`rsa`ç§é’¥ï¼Œ`2048`ä½å¼ºåº¦ï¼Œ`server.key`æ˜¯ç§˜é’¥æ–‡ä»¶å
(2) ç”Ÿæˆè‡ªç­¾åè¯ä¹¦

	openssl req -new -sha256 -x509 -days 365 -key server.key -out server.crt
	
è¾“å…¥ä¿¡æ¯

`Common Name`åº”è¯¥ä¸åŸŸåä¿æŒä¸€è‡´(å¦‚æˆ‘çš„ç”µè„‘æ­å»ºçš„æœåŠ¡å™¨`IP`åœ°å€ä¸º`10.100.152.185`)


#2. é…ç½®ApacheæœåŠ¡å™¨SSL

(1) æ”¾å…¥è¯ä¹¦

å°†`server.crt`å’Œ`server.key`ä¸¤ä¸ªæ–‡ä»¶æ‹·è´
æ”¾åˆ°`/etc/apache2/`ç›®å½•

(2) ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘`/etc/apache2/httpd.conf`æ–‡ä»¶
æ‰¾åˆ°å»æ‰ä¸‹é¢å‰è¾¹çš„æ³¨é‡Š#å·

```
LoadModule ssl_module libexec/apache2/mod_ssl.so
Include /private/etc/apache2/extra/httpd-vhosts.conf
Include /private/etc/apache2/extra/httpd-ssl.conf
LoadModule socache_shmcb_module libexec/apache2/mod_socache_shmcb.so
```

æ‰“å¼€`/etc/apache2/extra/httpd-ssl.conf`æ–‡ä»¶
å»æ‰ä»¥ä¸‹ä¸¤é¡¹æ³¨é‡Šå¹¶æ£€æŸ¥æ˜¯å¦ä¸ä¹‹å‰å®‰è£…ç§é’¥å’Œè¯ä¹¦çš„è·¯å¾„ä¸€è‡´
ï¼ˆé»˜è®¤å·²æ‰“å¼€ï¼‰

```
SSLCertificateFile "/private/etc/apache2/server.crt"
SSLCertificateKeyFile "/private/etc/apache2/server.key"
```


ç¼–è¾‘`/etc/apache2/extra/httpd-vhosts.conf`æ–‡ä»¶
åœ¨`<VirtualHost *:80> .....</VirtualHost>`åé¢æ·»åŠ ä¸€æ®µå¦‚ä¸‹å†…å®¹ï¼š

```
<VirtualHost *:443>
    SSLEngine on
    SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
    SSLCertificateFile /private/etc/apache2/server.crt
    SSLCertificateKeyFile /private/etc/apache2/server.key
    ServerName 10.100.152.185
    DocumentRoot "/Library/WebServer/Documents"
</VirtualHost>
```
æ³¨æ„`ServerName`å¡«å†™åŸŸåä¸æ‰€éœ€è®¿é—®ä¸€è‡´

(3) é‡å¯æœåŠ¡å™¨

```sudo apachectl restart```

è®¿é—®`https://10.100.152.185/`
æç¤ºä¸å®‰å…¨ä»€ä¹ˆçš„(å› ä¸ºè‡ªå·±çš„è¯ä¹¦æ²¡æ·»åŠ åˆ°æµè§ˆå™¨ä¿¡ä»»åˆ—è¡¨)ï¼Œç»§ç»­è®¿é—®


#3. è‡ªå·±ä½œä¸ºCAç­¾å‘è¯ä¹¦

(1) ç”Ÿæˆ`CA`æ ¹è¯ä¹¦

å…¶å®å°±æ˜¯è‡ªç­¾åè¯ä¹¦

å…ˆåœ¨æ¡Œé¢çš„`SSL`æ–‡ä»¶å¤¹é‡Œåˆ›å»ºä¸ª`CA`æ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾æ”¾è‡ªå·±ä½œä¸ºCAç”Ÿæˆçš„ç§é’¥è¯ä¹¦æ–‡ä»¶
æ‰“å¼€ç»ˆç«¯cdåˆ°CAæ–‡ä»¶å¤¹

	cd desktop/SSL/CA

ç§é’¥
	
	openssl genrsa -des3 -out ca.key 4096
	
è¿™é‡Œä½¿ç”¨`-des3`è¿›è¡ŒåŠ å¯†ï¼Œéœ€è¦å››ä½ä»¥ä¸Šå¯†ç 

è¯ä¹¦

	openssl req -new -x509 -days 365 -key ca.key -out ca.crt
	
æŒ‰1è‡ªç­¾åè¯ä¹¦æµç¨‹ï¼Œå¾—åˆ°`ca.key`å’Œ`ca.crt`



(2 )åˆ›å»ºæœåŠ¡å™¨ç§é’¥

	openssl genrsa -out server.key 4096
	
(3) ç”Ÿæˆè¯ä¹¦è¯·æ±‚æ–‡ä»¶CSR

	openssl req -new -key server.key -out server.csr
	
æ­¤æ—¶å·²å¾—åˆ°å¦‚ä¸‹4ä¸ªæ–‡ä»¶



(4) è‡ªå·±ä½œä¸ºCAç­¾å‘è¯ä¹¦

	openssl ca -in server.csr -out server.crt -cert ca.crt -keyfile ca.key -days 365
	
ç„¶åéœ€è¦è¾“å…¥ç”Ÿæˆca.keyæ—¶è®¾ç½®çš„å¯†ç 

å¦‚æœé‡åˆ°è¿™ä¸ªé—®é¢˜

ç”¨`/System/Library/OpenSSL/oppenssl.cnf`æ›¿æ¢ç›®å½•ä¸­çš„`/private/etc/ssl/openssl.cnf`æ–‡ä»¶

æ¥ç€é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼š

	I am unable to access the ./demoCA/newcerts directory ./demoCA/newcerts: No such file or directory


è§£å†³æ–¹æ³•
æ²¡æœ‰ç›®å½•åˆ›é€ ç›®å½•ä¹Ÿè¦ä¸Š
æ‰§è¡Œä»¥ä¸‹å‡ æ¡å‘½ä»¤åˆ›å»ºæ‰€éœ€çš„ç›®å½•åŠæ–‡ä»¶
	
	mkdir -p ./demoCA/newcerts
	touch demoCA/index.txt
	touch demoCA/serial
	echo 01 > demoCA/serial

åˆ›å»ºå¥½æ‰€éœ€ç›®å½•åŠæ–‡ä»¶



é‡æ–°æ‰§è¡Œå‘½ä»¤

	openssl ca -in server.csr -out server.crt -cert ca.crt -keyfile ca.key -days 365
	
è¾“å…¥`ca.key`å¯†ç 
ç„¶åä¼šæ‰“å°å‡ºè¯ä¹¦è¯¦ç»†è¿›è¡Œç¡®è®¤



è¾“å…¥ä¸¤æ¬¡`y`

å¾—åˆ°æœ€ç»ˆç”Ÿæˆçš„æ‰€æœ‰æ–‡ä»¶

æ‰€æœ‰ç”Ÿæˆæ–‡ä»¶
å›¾ç¤º`server.crt`å³è‡ªå·±ä½œä¸º`CA`ç­¾å‘çš„æœåŠ¡å™¨è¯ä¹¦

(5)æµ‹è¯•

*æµ‹è¯•1 CAç”ŸæˆæœåŠ¡å™¨è¯ä¹¦å¯ç”¨æ€§ï¼š
ï¼ˆ1ï¼‰å‰å¾€`/etc/apache2/`æ–‡ä»¶å¤¹

ï¼ˆ2ï¼‰åˆ é™¤åŸæ¥è‡ªç­¾åè¯ä¹¦ä¸¤ä¸ªæ–‡ä»¶
ï¼ˆ3ï¼‰å‘ç°`https://10.100.152.185/`å·²ç»ä¸èƒ½è®¿é—®(èƒ½è®¿é—®æœ‰å¯èƒ½æ˜¯ç¼“å­˜ï¼Œå¯ä»¥åˆ·æ–°æˆ–é‡å¯Apache)
ï¼ˆ4ï¼‰å°†CAç”Ÿæˆçš„`server.key`å’Œ`server.crt`ä¸¤ä¸ªæ–‡ä»¶æ‹·è´è¿›å»
ï¼ˆ5ï¼‰`https://10.100.152.185/` åˆå¯ä»¥è®¿é—®æˆåŠŸ
*æµ‹è¯•2 CAæ ¹è¯ä¹¦å¯ç”¨æ€§ï¼š
ï¼ˆ1ï¼‰æ–°æ‰“å¼€`https://10.100.152.185/` ï¼Œç”±äºè‡ªå·±çš„CAæ ¹è¯ä¹¦æœªåœ¨ä¿¡ä»»åˆ—è¡¨ï¼Œä¼šæœ‰è­¦å‘Š


ï¼ˆ2ï¼‰åŒå‡»ca.crtå®‰è£…(æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯Macç”µè„‘)
ï¼ˆ3ï¼‰åˆ°é’¥åŒ™ä¸²è®¿é—®ï¼Œæ‰¾åˆ°å®‰è£…çš„è¯ä¹¦ï¼Œå³é”®ç‚¹å‡» â†’ æ˜¾ç¤ºç®€ä»‹ â†’ è®¾ç½®å§‹ç»ˆä¿¡ä»»
ï¼ˆ4ï¼‰å‘ç°`https://10.100.152.185` ä¸å†è­¦å‘Š

*æ‰‹æœºå®‰è£…å¿…é¡»

`ï¼ˆ5ï¼‰æ‰‹æœºå®‰è£…ca.crtè¯ä¹¦ï¼Œä½¿ç”¨è‡ªå¸¦çš„mailé‚®ç®±å‘é€è¯ä¹¦åˆ°æ‰‹æœºä¸Šé¢å®‰è£…ã€‚`

`*æç¤ºæ— æ³•è¿æ¥â€˜XXXXXX'`

æœ€åæŠŠplistæ”¾åˆ°githubä¸Š ç‚¹å‡»`raw`é¢„è§ˆå¾—åˆ°åœ°å€

	itms-services:///?action=download-manifest&url=https://raw.githubusercontent.com/Blavtes/IPALoadConfig/master/manifest.plist
	
å¯ä»¥æ­£å¸¸ä¸‹è½½å®‰è£…ã€‚ï¼ˆéœ€è¦appæ‰“åŒ…è¯ä¹¦æ”¯æŒã€‚ï¼‰

`*æç¤ºæœåŠ¡å™¨è¯ä¹¦ æ— æ•ˆï¼Œå¯èƒ½å› ä¸ºipa åœ°å€è·¯å¾„ä¸å¯¹ï¼Œæ£€æŸ¥mainfest.plist ä¸­ipaåœ°å€`

`*æ³¨æ„: itms-services:åé¢æ˜¯ä¸‰ä¸ªâ€œ / â€ï¼Œåƒä¸‡åˆ«æ¼æ‰ä¸€ä¸ªï¼ï¼ï¼`

#(6)å¦‚ä½•è·å–mainfest.plistæ–‡ä»¶

åœ¨`xcode`->`organizer`-> `archives`ä¸‹é€‰æ‹©å·²æ‰“åŒ…å¥½çš„æ–‡ä»¶ï¼Œå¯¼å‡ºipaåŒ…ã€‚é€‰æ‹©developmentï¼ˆå¼€å‘è€…æ¨¡å¼ã€ä¹Ÿå¯æ›¿æ¢ä¸ºä¼ä¸šè¯ä¹¦æ‰“åŒ…æ¨¡å¼ï¼‰ï¼Œå¡«å†™APPURL ã€‚
appURL ä¸ºæ”¯æŒhttpsæœåŠ¡å™¨ä¸ŠipaåŒ…åœ°å€ 

ç”Ÿæˆçš„plist æ”¾åˆ°æœåŠ¡å™¨ã€‚è¿™é‡Œæ”¾åˆ°githubã€‚httpsæœåŠ¡å™¨ä¸ºæœ¬åœ°ç¯å¢ƒ

#åˆ¶ä½œhtml webä¸‹è½½æ–‡ä»¶

	<!DOCTYPE html>
	<html lang="zh-CN">
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<body style="background:#CDE; color:#FFF">
		<a href="itms-services:///?action=download-manifest&url=https://raw.githubusercontent.com/Blavtes/IPALoadConfig/master/GjFax/manifest-my.plist">
				<div style="margin-top:30px;">
				 <center>
			        <font size="10" color="#3789dd" style="padding-left:0pt;">ios-é›†æˆä¸‹è½½ </font>
			    </center>
			    </div>
		</a>
			//å¯åŠ ä¸ªäºŒç»´ç 
			<div style="margin-top: 100px">
			<center>
				<img src="https://github.com/Blavtes/IPALoadConfig/blob/master/GjFax/AppIcon57x57.png?raw=true" width="200" />
			</center>
		</div>
		</body>
	</html>
	
è‡³æ­¤ç»“æŸwebä¸‹è½½å®‰è£…appæµ‹è¯•ç‰ˆæœ¬ã€‚ï¼ˆğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ï¼‰
